<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<title>PLAYERS</title>
		<script type="text/javascript" src="js/util.js"></script>
		<script type="text/javascript" src="js/validation.js"></script>
		<script type="text/javascript">
			let players = [
						["43127678F", "Juan", "Pérez Gómez", "692403829", "jperez@gmail.com", "12/12/1980", "ES6621000418401234567891", "PRO"],
						["43125043G", "Adolfo", "Gutiérrez Lorma", "692403829", "agutierrez@gmail.com", "12/12/1985", "ES6000491500051234567892", "PRO"],
						["43125430I", "Carles", "Vich Lorem", "692403829", "cvich@gmail.com", "12/12/1981", "ES9420805801101234567891", "PRO"],
						["43124345J", "Gustavo", "Cander More", "692403829", "gmore@gmail.com", "12/12/1995", "ES9000246912501234567891", "PRO"],
						["43127678F", "Alicia", "Pérez Gómez", "692403829", "jperez@gmail.com", "12/12/1980", "ES6621000418401234567891", "BEG"],
						["43125043G", "David", "Gutiérrez Lorma", "692403829", "agutierrez@gmail.com", "12/12/1985", "ES6000491500051234567892", "BEG"],
						["43125430I", "Patricia", "Vich Lorem", "692403829", "cvich@gmail.com", "12/12/1981", "ES9420805801101234567891", "BEG"],
						["43124345J", "Pepa", "Cander More", "692403829", "gmore@gmail.com", "12/12/1995", "ES9000246912501234567891", "BEG"]
				];

	// pAnys sera válido si es 16 para beginers y 18 para profesionales
	function isValidPlayer(pMinAnys){

		// Lògica a l'afegir el jugador
		let dataNai = document.getElementById("fecha").value;
		let aDate = dataNai.split("/"); // array: dia, mes año

		// JavaScript counts months from 0 to 11
		let bornDate = new Date(aDate[2], aDate[1]-1, aDate[0]);

		let currentDate = new Date();
		let age = diffAnys(currentDate, bornDate);

		return (age>=pMinAnys);

	};

	// Función para pintar los jugadores dinámicamente
	function createListPlayers(pJugadores, pContenedor, pTipo){

	 	 pContenedor.innerHTML="<h3>lista de jugadores</h3>";
	 	 for(let i=0;i<pJugadores.length;i++){
	 			 let jugador = pJugadores[i];
				 //alert(pJugadores[i][1]);
				 //alert(i);
				 if(pTipo==jugador[7])
				 {
	 			 		pContenedor.innerHTML+="<p>" + jugador[1] +
																		"<span> " +  jugador[2] + "</span>" +
																		"<span> " +  jugador[3] + "</span>" +
																		"<span> " +  jugador[4] + "</span>" +
																		"</p>";
				 }
	 	 }

	  }

		// Función para comprobar los datos del formulario
		function checkForm(){
				// Recuperados campos formulario
				let camp_dni = document.getElementById("dni");
				let camp_nombre = document.getElementById("nombre");
				let camp_apellidos= document.getElementById("apellidos");
				let camp_telefono= document.getElementById("telefono");
				let camp_fecha= document.getElementById("fecha");
				// Recuperamos el valor de los campos teléfono y fecha
				let txtTel=camp_telefono.value;
				let txtDate=camp_fecha.value;

				if( !validaTelefon(txtTel) || txtTel==""){
					alert("Telèfon erroni");
					return false;
				}

				if( !validaData(txtDate) || txtDate==""){
					alert("Data errònia");
					return false;
				}

				if (!isValidPlayer(16)){
					alert("Los jugadores tienen que ser mayores de 16 años");
					return false;
				}
				// Comprobar datos obligatorios
				if (camp_dni.value!="" && camp_nombre.value!="" && camp_apellidos.value!=""){

					//Añadir datos al array (nuevo jugador)
					players.push([camp_dni.value, camp_nombre.value, camp_apellidos.value, txtTel, "", txtDate, "", "BEG"])

					let containerPlayers = document.getElementById("c_players");
					createListPlayers(players, containerPlayers, "BEG");
					alert("Datos insertados correctamente");

				}else{
					alert("Todos los campos son obligatorios");
				}

		}

		window.onload=function(){
					console.log("Cargado correctamente");
					//alert("cargado correctamente");

					// El div contenedor de los jugadores
					let containerPlayers= document.getElementById("c_players");

					// llamada a la función para beginners
					createListPlayers(players, containerPlayers, "BEG");

					// Div para la segunda lista (ahora solo profesionales)
					let containerPlayersPro = document.getElementById("c_players_pro");
					// Segunda llamada a la función
					createListPlayers(players, containerPlayersPro, "PRO");


		}

		</script>
	</head>
	<body>

		<form class="" action="index.html" method="post">
			<p>
				<label>Dni:</label>
				<input type="text" id="dni" name="dni" value="">
			</p>
			<p>
				<label>Nombre:</label>
				<input type="text" id="nombre" name="nombre" value="">
			</p>
			<p>
				<label>Apellidos:</label>
				<input type="text" id="apellidos" name="apellidos" value="">
			</p>
			<p>
				<label>Telefono:</label>
				<input type="text" id="telefono" name="telefono" value="">
			</p>
			<p>
				<label>Fecha:</label>
				<input type="text" id="fecha" name="fecha" value="">
			</p>
			<button type="button" id="bt-enviar" name="button" onclick="checkForm()">Añadir jugador</button>
		</form>

		<div id="c_players"></div>
		<div id="c_players_pro"></div>

	</body>
</html>
